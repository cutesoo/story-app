const VAPID_PUBLIC_KEY="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",CACHE_NAME="story-app-v1",urlsToCache=["/","/index.html","/favicon.png","/styles/styles.css","/app.bundle.js","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"];function urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),a=new Uint8Array(n.length);for(let e=0;e<n.length;++e)a[e]=n.charCodeAt(e);return a}self.addEventListener("install",(e=>{console.log("Service Worker: Installing and Caching App Shell"),e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(urlsToCache))).then((()=>self.skipWaiting())).catch((e=>console.error("Failed to cache during install:",e))))})),self.addEventListener("activate",(e=>{console.log("Service Worker: Activated"),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>e!==CACHE_NAME?(console.log("Service Worker: Deleting old cache",e),caches.delete(e)):null))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{const t=new URL(e.request.url);urlsToCache.includes(t.pathname)||t.origin===location.origin?e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request)))):"story-api.dicoding.dev"!==t.hostname?e.respondWith(fetch(e.request).then((async t=>((await caches.open(CACHE_NAME)).put(e.request,t.clone()),t))).catch((async()=>await caches.match(e.request)||new Response("Offline and no cached content available.",{status:503,statusText:"Service Unavailable"})))):e.respondWith(fetch(e.request).then((async t=>{const n=t.clone();return(await caches.open(CACHE_NAME)).put(e.request,n),t})).catch((async()=>await caches.match(e.request)||new Response("Offline and no cached data available.",{status:503,statusText:"Service Unavailable"}))))})),self.addEventListener("push",(e=>{console.log("Service Worker: Push Received!");const t=e.data.json(),n=t.title||"Story App Notification",a={body:t.options.body||"You have a new notification.",icon:"/favicon.png",badge:"/favicon.png"};e.waitUntil(self.registration.showNotification(n,a))})),self.addEventListener("notificationclick",(e=>{console.log("Notification clicked",e),e.notification.close(),e.waitUntil(clients.openWindow("/"))}));